<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Abrir link — Editor JSON & Ferramentas</title>
  <style>
    :root{font-family:system-ui,-apple-system,'Segoe UI',Roboto,Helvetica,Arial; color:#111}
    body{max-width:980px;margin:20px auto;padding:18px;border-radius:10px;background:#fafafa;border:1px solid #eee}
    h1{font-size:20px;margin:0 0 8px}
    p{margin:6px 0;color:#333}
    .cols{display:flex;gap:12px;flex-wrap:wrap}
    .card{flex:1;min-width:300px;background:#fff;padding:12px;border-radius:8px;border:1px solid #e6e6e6}
    pre.json{background:#f7f9fc;border:1px dashed #e0e7ff;padding:10px;border-radius:6px;white-space:pre-wrap;word-wrap:break-word;font-size:13px}
    textarea{width:100%;min-height:160px;padding:8px;border-radius:6px;border:1px solid #ddd;font-family:monospace;resize:vertical}
    input[type="text"]{width:100%;padding:8px;border-radius:6px;border:1px solid #ccc}
    .row{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    button{padding:8px 12px;border-radius:6px;border:1px solid #cfcfcf;background:#fff;cursor:pointer}
    button.primary{background:#0b76ff;color:#fff;border-color:#055ed1}
    button.ghost{background:#f8fafc;border-color:#e6eefc}
    small.note{display:block;color:#666;margin-top:8px}
    .status{margin-top:10px;padding:10px;border-radius:6px;background:#fff;border:1px solid #eee}
    footer{margin-top:14px;font-size:13px;color:#666}
    label{font-size:13px;color:#333}
  </style>
</head>
<body>
  <h1>Abrir link — Editor JSON & Ferramentas</h1>
  <p>Edite o JSON, aplique, gere bookmarklet, abra links. Aviso: abrir links arbitrários pode ser perigoso — confie nas fontes.</p>

  <div class="cols">
    <div class="card" style="flex:1.2">
      <h3>1) JSON atual</h3>
      <pre class="json" id="jsonView"></pre>

      <div style="margin-top:10px;">
        <label for="jsonEdit"><strong>Editar / criar novo JSON</strong> (ex.: {"abrirImagem":"https://...","requesição":"executar","autorizado":true})</label>
        <textarea id="jsonEdit" placeholder='Cole ou escreva seu JSON aqui'></textarea>
        <div class="row" style="margin-top:8px;">
          <button id="btnApply" class="primary">Aplicar JSON</button>
          <button id="btnValidate" class="ghost">Validar JSON</button>
          <button id="btnClear" class="ghost">Limpar / Novo JSON</button>
          <button id="btnReset" class="ghost">Restaurar Exemplo</button>
        </div>
        <small class="note">Ao aplicar, o JSON válido substituirá a base de dados usada pelos botões abaixo. A aplicação não modifica URLs — usa-as como estão.</small>
      </div>

      <div class="status" id="statusIO">Status: pronto.</div>
    </div>

    <div class="card">
      <h3>2) Abrir links</h3>

      <label><strong>Abrir URL do JSON</strong> — chave (campo) a usar:</label>
      <div class="row" style="margin-top:6px;">
        <input type="text" id="jsonKey" value="abrirImagem" />
        <button id="btnOpenJsonNew" class="primary">Abrir na nova aba</button>
        <button id="btnOpenJsonSame">Abrir na mesma aba</button>
      </div>
      <small class="note">Ex.: se seu JSON tiver {"abrirImagem":"https://..."}, use a chave <code>abrirImagem</code>.</small>

      <hr style="margin:12px 0;border:none;border-top:1px solid #f0f0f0" />

      <label><strong>Abrir qualquer link (entrada livre)</strong></label>
      <input type="text" id="freeUrl" placeholder="Cole aqui qualquer URL, ex.: https://example.com/arquivo.jpg" />
      <div class="row" style="margin-top:8px;">
        <button id="btnOpenFreeNew" class="primary">Abrir nova aba</button>
        <button id="btnOpenFreeSame">Abrir mesma aba</button>
        <button id="btnTestScheme" class="ghost">Testar/Normalizar (verifica esquema)</button>
      </div>
      <small class="note">Se o texto não contém esquema (http/https) será alertado. Você pode inserir qualquer URL — atenção à segurança.</small>

      <hr style="margin:12px 0;border:none;border-top:1px solid #f0f0f0" />

      <label><strong>PESQUISAR a URL (Motor)</strong></label>
      <div class="row" style="margin-top:6px;">
        <select id="searchEngine" style="padding:8px;border-radius:6px;border:1px solid #ccc;">
          <option value="google">Google</option>
          <option value="bing">Bing</option>
        </select>
        <button id="btnSearchJson">Pesquisar URL do JSON</button>
        <button id="btnSearchFree">Pesquisar texto da caixa livre</button>
      </div>
    </div>

    <div class="card">
      <h3>3) Bookmarklet / Download</h3>
      <div>
        <button id="btnGenBookmark" class="primary">Gerar & Copiar Bookmarklet (usa chave atual)</button>
        <button id="btnShowBookmark" class="ghost">Mostrar Bookmarklet</button>
        <button id="btnRunBookmark" class="ghost">Executar Bookmarklet (abrir)</button>
      </div>

      <div style="margin-top:10px;">
        <label>Bookmarklet:</label>
        <textarea id="bookmarklet" readonly placeholder="Aqui aparece o bookmarklet"></textarea>
        <small class="note">Arraste o texto do bookmarklet para a barra de favoritos ou copie-o.</small>
      </div>

      <div style="margin-top:12px;">
        <button id="btnDownloadHtml" class="primary">Download HTML com URL embutida (usa chave atual)</button>
      </div>

      <hr style="margin:12px 0;border:none;border-top:1px solid #f0f0f0" />

      <div>
        <label><strong>Exemplo rápido do JSON atual</strong></label>
        <pre id="examplePreview" style="background:#fff;padding:8px;border-radius:6px;border:1px solid #eee"></pre>
      </div>
    </div>
  </div>

  <footer>
    <small style="color:#a33"><strong>Atenção:</strong> abrir links externos pode expor seu navegador a riscos. Use links confiáveis. O arquivo roda localmente no seu navegador — nada é enviado a servidores.</small>
  </footer>

<script>
/* ---------- Estado inicial ---------- */
let baseDados = {
  "abrirImagem": "https://th.bing.com/th/id/R.e7719d6b719667d7f94dce7b73b6f939?rik=NVW8F8hxKlOxuw&riu=http%3a%2f%2fgetwallpapers.com%2fwallpaper%2ffull%2f2%2fc%2f4%2f471494.jpg&ehk=XFi3aq0EHSl3NyHy7R%2fS6AFEhfgKByTD5LXZnz5Y4lw%3d&risl=&pid=ImgRaw&r=0",
  "requesição": "executar",
  "autorizado": true
};

const jsonView = document.getElementById('jsonView');
const jsonEdit = document.getElementById('jsonEdit');
const statusIO = document.getElementById('statusIO');
const examplePreview = document.getElementById('examplePreview');

function refreshViews() {
  jsonView.textContent = JSON.stringify(baseDados, null, 2);
  examplePreview.textContent = `Chave padrão: abrirImagem\nValor atual (se existir):\n${baseDados.abrirImagem ? baseDados.abrirImagem : '(não definido)'}`;
}

/* ---------- Utilitários ---------- */

function setStatus(msg, isError=false) {
  statusIO.textContent = 'Status: ' + msg;
  statusIO.style.color = isError ? '#900' : '#035';
}

function tryParseJson(text) {
  try {
    const obj = JSON.parse(text);
    return {ok:true, obj};
  } catch(err) {
    return {ok:false, error: err.message};
  }
}

function validUrlLike(s) {
  // retorna true se parecer uma URL com esquema http/https
  try {
    const u = new URL(s);
    return u.protocol === 'http:' || u.protocol === 'https:';
  } catch(e) {
    return false;
  }
}

/* ---------- Botões JSON ---------- */

document.getElementById('btnApply').addEventListener('click', () => {
  const txt = jsonEdit.value.trim();
  if (!txt) { setStatus('Textarea vazio — nada aplicado.', true); return; }
  const parsed = tryParseJson(txt);
  if (!parsed.ok) {
    setStatus('JSON inválido: ' + parsed.error, true);
    return;
  }
  baseDados = parsed.obj;
  refreshViews();
  setStatus('JSON aplicado com sucesso.');
});

document.getElementById('btnValidate').addEventListener('click', () => {
  const txt = jsonEdit.value.trim();
  if (!txt) { setStatus('Textarea vazio — nada para validar.', true); return; }
  const parsed = tryParseJson(txt);
  if (!parsed.ok) {
    setStatus('JSON inválido: ' + parsed.error, true);
    return;
  }
  setStatus('JSON válido ✔');
});

document.getElementById('btnClear').addEventListener('click', () => {
  jsonEdit.value = '';
  setStatus('Textarea limpa — crie um novo JSON.');
});

document.getElementById('btnReset').addEventListener('click', () => {
  baseDados = {
    "abrirImagem": "https://th.bing.com/th/id/R.e7719d6b719667d7f94dce7b73b6f939?rik=NVW8F8hxKlOxuw&riu=http%3a%2f%2fgetwallpapers.com%2fwallpaper%2ffull%2f2%2fc%2f4%2f471494.jpg&ehk=XFi3aq0EHSl3NyHy7R%2fS6AFEhfgKByTD5LXZnz5Y4lw%3d&risl=&pid=ImgRaw&r=0",
    "requesição": "executar",
    "autorizado": true
  };
  jsonEdit.value = JSON.stringify(baseDados, null, 2);
  refreshViews();
  setStatus('Exemplo restaurado.');
});

/* ---------- Abertura de links (do JSON) ---------- */

function openUrlInNewTab(url) {
  window.open(url, '_blank', 'noopener,noreferrer');
}
function openUrlSameTab(url) {
  location.href = url;
}

document.getElementById('btnOpenJsonNew').addEventListener('click', () => {
  const key = document.getElementById('jsonKey').value || 'abrirImagem';
  if (!baseDados || typeof baseDados !== 'object' || !(key in baseDados)) {
    setStatus(`Chave "${key}" não encontrada no JSON.`, true);
    return;
  }
  const url = String(baseDados[key]);
  if (!url) { setStatus('Valor vazio para a chave selecionada.', true); return; }
  // NÃO alteramos a URL — abrimos exatamente como está
  openUrlInNewTab(url);
  setStatus(`Solicitado: abrir valor da chave "${key}" em nova aba.`);
});

document.getElementById('btnOpenJsonSame').addEventListener('click', () => {
  const key = document.getElementById('jsonKey').value || 'abrirImagem';
  if (!baseDados || typeof baseDados !== 'object' || !(key in baseDados)) {
    setStatus(`Chave "${key}" não encontrada no JSON.`, true);
    return;
  }
  const url = String(baseDados[key]);
  if (!url) { setStatus('Valor vazio para a chave selecionada.', true); return; }
  setStatus('Abrindo na mesma aba...');
  openUrlSameTab(url);
});

/* ---------- Caixa livre (qualquer link) ---------- */

document.getElementById('btnOpenFreeNew').addEventListener('click', () => {
  const url = document.getElementById('freeUrl').value.trim();
  if (!url) { setStatus('Insira uma URL na caixa livre.', true); return; }
  // abrimos exatamente o que usuário inseriu — mas alertamos se não parecer http/https
  if (!validUrlLike(url)) {
    if (!confirm('A URL não parece ter esquema (http/https) ou é inválida. Deseja tentar abrir mesmo assim?')) {
      setStatus('Ação cancelada pelo usuário (URL parece inválida).', true);
      return;
    }
  }
  try {
    openUrlInNewTab(url);
    setStatus('Solicitado: abrir URL livre em nova aba.');
  } catch (e) {
    setStatus('Erro ao abrir URL: ' + e.message, true);
  }
});

document.getElementById('btnOpenFreeSame').addEventListener('click', () => {
  const url = document.getElementById('freeUrl').value.trim();
  if (!url) { setStatus('Insira uma URL na caixa livre.', true); return; }
  if (!validUrlLike(url)) {
    if (!confirm('A URL não parece ter esquema (http/https). Deseja abrir mesmo assim?')) {
      setStatus('Ação cancelada pelo usuário (URL parece inválida).', true);
      return;
    }
  }
  setStatus('Abrindo na mesma aba...');
  openUrlSameTab(url);
});

document.getElementById('btnTestScheme').addEventListener('click', () => {
  const url = document.getElementById('freeUrl').value.trim();
  if (!url) { setStatus('Caixa livre vazia.', true); return; }
  if (validUrlLike(url)) {
    setStatus('OK — URL válida com esquema http/https.');
  } else {
    setStatus('Atenção — a URL não parece válida. Considere adicionar "https://" no início.', true);
  }
});

/* ---------- Pesquisar (Google/Bing) ---------- */

function searchEngineUrl(engine, text) {
  const q = encodeURIComponent(text);
  if (engine === 'google') return `https://www.google.com/search?q=${q}`;
  if (engine === 'bing') return `https://www.bing.com/search?q=${q}`;
  return null;
}

document.getElementById('btnSearchJson').addEventListener('click', () => {
  const engine = document.getElementById('searchEngine').value;
  const key = document.getElementById('jsonKey').value || 'abrirImagem';
  if (!baseDados || !(key in baseDados)) { setStatus(`Chave "${key}" não encontrada no JSON.`, true); return; }
  const text = String(baseDados[key]);
  const s = searchEngineUrl(engine, text);
  openUrlInNewTab(s);
  setStatus(`Pesquisa aberta no ${engine} com o conteúdo da chave "${key}".`);
});

document.getElementById('btnSearchFree').addEventListener('click', () => {
  const engine = document.getElementById('searchEngine').value;
  const text = document.getElementById('freeUrl').value.trim();
  if (!text) { setStatus('Caixa livre vazia para pesquisa.', true); return; }
  const s = searchEngineUrl(engine, text);
  openUrlInNewTab(s);
  setStatus(`Pesquisa aberta no ${engine} com o texto da caixa livre.`);
});

/* ---------- Bookmarklet / Download ---------- */

function makeBookmarkletFromUrl(url) {
  const esc = url.replace(/'/g,"\\'");
  return `javascript:(function(){window.open('${esc}','_blank','noopener,noreferrer');})();`;
}

document.getElementById('btnGenBookmark').addEventListener('click', async () => {
  const key = document.getElementById('jsonKey').value || 'abrirImagem';
  if (!baseDados || !(key in baseDados)) { setStatus(`Chave "${key}" não encontrada no JSON.`, true); return; }
  const url = String(baseDados[key]);
  if (!url) { setStatus('Valor vazio para a chave (bookmarklet não gerado).', true); return; }
  const bm = makeBookmarkletFromUrl(url);
  document.getElementById('bookmarklet').value = bm;
  try {
    await navigator.clipboard.writeText(bm);
    setStatus('Bookmarklet gerado e copiado para a área de transferência.');
  } catch(e) {
    setStatus('Bookmarklet gerado (não copiado automaticamente).', false);
  }
});

document.getElementById('btnShowBookmark').addEventListener('click', () => {
  const key = document.getElementById('jsonKey').value || 'abrirImagem';
  if (!baseDados || !(key in baseDados)) { setStatus(`Chave "${key}" não encontrada no JSON.`, true); return; }
  const url = String(baseDados[key]);
  const bm = makeBookmarkletFromUrl(url);
  document.getElementById('bookmarklet').value = bm;
  setStatus('Bookmarklet exibido abaixo.');
});

document.getElementById('btnRunBookmark').addEventListener('click', () => {
  const key = document.getElementById('jsonKey').value || 'abrirImagem';
  if (!baseDados || !(key in baseDados)) { setStatus(`Chave "${key}" não encontrada no JSON.`, true); return; }
  const url = String(baseDados[key]);
  openUrlInNewTab(url);
  setStatus('Executado: bookmarklet (abertura em nova aba).');
});

document.getElementById('btnDownloadHtml').addEventListener('click', () => {
  const key = document.getElementById('jsonKey').value || 'abrirImagem';
  if (!baseDados || !(key in baseDados)) { setStatus(`Chave "${key}" não encontrada no JSON.`, true); return; }
  const url = String(baseDados[key]);
  const html = `<!doctype html>
<html lang="pt-BR">
<head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Abrir link direto</title></head>
<body>
  <h1>Abrir link embutido</h1>
  <p>Link embutido exatamente como recebido (campo: ${key}):</p>
  <pre>${url}</pre>
  <p><a href="${url}" target="_blank" rel="noopener noreferrer">Abrir em nova aba</a></p>
</body>
</html>`;
  const blob = new Blob([html], {type:'text/html'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'abrir-link-embutido.html';
  document.body.appendChild(a);
  a.click();
  a.remove();
  setStatus('Download iniciado: HTML gerado com a URL embutida.');
});

/* ---------- Inicialização ---------- */
jsonEdit.value = JSON.stringify(baseDados, null, 2);
refreshViews();
setStatus('Pronto. Edite o JSON ou cole um link e use os botões.');
</script>
</body>
</html>
